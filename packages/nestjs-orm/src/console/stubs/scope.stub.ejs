import { Injectable } from '@nestjs/common';
import { FilterQuery } from '@nesvel/nestjs-orm';

/**
 * <%= className %>
 *
 * Query scope for <%= description || 'applying reusable query constraints' %>
 *
 * @description <%= className %> query scope implementation
 * @author Generated by @nesvel/nestjs-orm
 * @since 1.0.0
 *
 * @example
 * ```typescript
 * // Use in repository:
 * import { <%= className %> } from '@/scopes/<%= fileName %>.scope';
 *
 * const results = await repository.find(
 *   new <%= className %>().apply()
 * );
 * ```
 *
 * @example
 * ```typescript
 * // Combine with other constraints:
 * const results = await repository.find({
 *   ...new <%= className %>().apply(),
 *   name: { $like: '%test%' }
 * });
 * ```
 */
@Injectable()
export class <%= className %><T = any> {
  /**
   * Apply the scope constraints to a query
   *
   * @returns FilterQuery object with scope constraints
   *
   * @example
   * ```typescript
   * // Example implementation for Active scope:
   * apply(): FilterQuery<T> {
   *   return {
   *     isActive: true,
   *     deletedAt: null,
   *   } as FilterQuery<T>;
   * }
   * ```
   */
  apply(): FilterQuery<T> {
    // TODO: Implement scope logic

    // Common scope examples:

    // Active records scope:
    // return { isActive: true } as FilterQuery<T>;

    // Published content scope:
    // return {
    //   publishedAt: { $lte: new Date() },
    //   status: 'published',
    // } as FilterQuery<T>;

    // Recent records scope (last 30 days):
    // const thirtyDaysAgo = new Date();
    // thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
    // return {
    //   createdAt: { $gte: thirtyDaysAgo },
    // } as FilterQuery<T>;

    // Soft delete scope (non-deleted only):
    // return { deletedAt: null } as FilterQuery<T>;

    return {} as FilterQuery<T>;
  }

  /**
   * Apply scope with custom parameters
   *
   * @param params - Custom parameters for dynamic filtering
   * @returns FilterQuery object with scope constraints
   *
   * @example
   * ```typescript
   * // Date range scope:
   * applyWithParams({ startDate, endDate }): FilterQuery<T> {
   *   return {
   *     createdAt: {
   *       $gte: startDate,
   *       $lte: endDate,
   *     },
   *   } as FilterQuery<T>;
   * }
   * ```
   */
  // applyWithParams(params: any): FilterQuery<T> {
  //   // TODO: Implement parameterized scope
  //   return {} as FilterQuery<T>;
  // }
}

/**
 * Helper function to create and apply scope
 *
 * @returns FilterQuery with scope constraints applied
 *
 * @example
 * ```typescript
 * const results = await repository.find(<%= fileName.replace(/-/g, '') %>Scope());
 * ```
 */
export function <%= fileName.replace(/-/g, '') %>Scope<T = any>(): FilterQuery<T> {
  return new <%= className %><T>().apply();
}
