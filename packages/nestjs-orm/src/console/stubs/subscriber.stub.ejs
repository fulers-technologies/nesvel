import { Injectable } from '@nestjs/common';
import { BaseSubscriber } from '@nesvel/nestjs-orm';
import { InjectPubSub, PubSubService } from '@nesvel/nestjs-pubsub';

import { <%= entityName %> } from '@/entities/<%= fileName %>.entity';

/**
 * <%= className %>
 *
 * Entity subscriber for <%= entityName %> lifecycle events.
 * Extends BaseSubscriber to automatically publish entity events to PubSub.
 *
 * This subscriber listens to <%= entityName %> entity lifecycle events and publishes
 * them to the PubSub system for consumption by other services. It inherits all
 * functionality from BaseSubscriber including:
 * - Automatic event publishing on create, update, delete
 * - Change tracking with before/after values
 * - Performance metrics (optional)
 * - Configurable channel naming patterns
 * - Sensitive data sanitization
 *
 * Published Events:
 * - <%= fileName %>.created - When a new <%= entityName %> is created
 * - <%= fileName %>.updated - When an existing <%= entityName %> is updated
 * - <%= fileName %>.deleted - When a <%= entityName %> is hard deleted
 * - <%= fileName %>.soft_deleted - When a <%= entityName %> is soft deleted
 * - <%= fileName %>.loaded - When a <%= entityName %> is loaded (if enabled)
 *
 * @description Subscribes to and publishes <%= entityName %> entity events
 * @author Generated by @nesvel/nestjs-orm
 * @since 1.0.0
 *
 * @example
 * ```typescript
 * // Register in module:
 * @Module({
 *   providers: [<%= className %>],
 * })
 * export class AppModule {}
 *
 * // Listen to events in another service:
 * this.pubsub.subscribe('<%= fileName %>.created', (payload) => {
 *   console.log('New <%= entityName %> created:', payload.entityId);
 *   // Send notification, update cache, etc.
 * });
 * ```
 */
@Injectable()
export class <%= className %> extends BaseSubscriber<<%= entityName %>> {
  /**
   * Constructor for <%= className %>
   *
   * Injects the PubSub service and configures subscriber options.
   * The parent BaseSubscriber handles all event publishing logic.
   *
   * @param pubsub - PubSub service for event publishing
   */
  constructor(@InjectPubSub() pubsub: PubSubService) {
    super(pubsub, {
      enabled: true, // Enable event publishing
      logEvents: false, // Disable logging to prevent spam
      publishLoadEvents: false, // Don't publish load events
      trackDetailedChanges: true, // Enable change tracking for updates
      includePerformanceMetrics: false, // Disable performance tracking
      channelPattern: '{entityName}.{operation}', // Simple channel naming
    });
  }

  /**
   * Get the entities this subscriber listens to
   *
   * Returns an array containing the <%= entityName %> entity class.
   * Only events from <%= entityName %> entities will trigger this subscriber.
   *
   * @returns Array containing <%= entityName %> entity class
   */
  getSubscribedEntities(): any[] {
    return [<%= entityName %>];
  }

  // ============================================================================
  // Note: The BaseSubscriber already handles:
  // - Publishing events to PubSub on all lifecycle events
  // - Change tracking with before/after values on updates
  // - Sensitive data sanitization
  // - Performance metrics (if enabled)
  // - Error handling that won't break database operations
  //
  // You only need to override methods if you need ADDITIONAL custom behavior
  // beyond the automatic event publishing provided by BaseSubscriber.
  // ============================================================================
}
