import { Injectable } from '@nestjs/common';
import { BasePublisher, PubSubService, PublishOptions } from '@nesvel/nestjs-pubsub';

/**
 * <%= className %>Publisher
 *
 * Publisher for <%= topicName %> topic.
 * Extends BasePublisher to provide hooks for validation, transformation, and logging.
 *
 * Use publishers when you need:
 * - Data validation before publishing
 * - Data transformation
 * - Logging and monitoring
 * - Consistent publishing patterns across the application
 *
 * For simple publishing, you can inject PubSubService directly.
 */
@Injectable()
export class <%= className %>Publisher extends BasePublisher<any> {
  /**
   * Constructor
   *
   * @param pubsub - The PubSub service instance
   */
  constructor(protected readonly pubsub: PubSubService) {
    super(pubsub);
  }

  /**
   * Get the topic this publisher publishes to
   */
  getTopic(): string {
    return '<%= topicName %>';
  }

  /**
   * Hook executed before publishing
   * Use this for:
   * - Data validation
   * - Data transformation
   * - Logging
   *
   * @param data - The data to be published
   * @param options - Publishing options
   */
  protected async beforePublish(data: any, options?: PublishOptions): Promise<void> {
    // TODO: Add validation, transformation, or logging logic

    // Example: Validate data
    // if (!data.id) {
    //   throw new Error('Data must have an id');
    // }

    // Example: Log publishing attempt
    // console.log(`Publishing to <%= topicName %>:`, data);
  }

  /**
   * Hook executed after publishing
   * Use this for:
   * - Success logging
   * - Metrics collection
   * - Cleanup tasks
   *
   * @param data - The published data
   * @param options - Publishing options used
   */
  protected async afterPublish(data: any, options?: PublishOptions): Promise<void> {
    // TODO: Add post-publish logic

    // Example: Log successful publish
    // console.log(`Successfully published to <%= topicName %>`);

    // Example: Update metrics
    // await this.metricsService.increment('pubsub.<%= topicName %>.published');
  }
}
