import { Injectable } from '@nestjs/common';
import { Subscribe, IPubSubMessage } from '@nesvel/nestjs-pubsub';

/**
 * <%= className %>Listener
 *
 * Listener for <%= topicName %> topic using @Subscribe decorators.
 * This is the recommended approach for 80% of subscription use cases.
 *
 * Use listeners with @Subscribe when you need:
 * - Simple, declarative subscriptions
 * - Multiple handlers for different topics in one class
 * - Quick setup without lifecycle complexity
 *
 * For complex processing needs, consider using BaseConsumer instead.
 */
@Injectable()
export class <%= className %>Listener {
  /**
   * Handle messages from <%= topicName %> topic
   *
   * @param message - The PubSub message containing data and metadata
   *
   * @example
   * // Message structure:
   * {
   *   data: { ... },           // Your message payload
   *   topic: '<%= topicName %>',
   *   timestamp: Date,
   *   metadata: { ... }
   * }
   */
  @Subscribe('<%= topicName %>')
  async handle<%= className %>(message: IPubSubMessage<any>): Promise<void> {
    // TODO: Implement message processing logic
    console.log(`Received <%= topicName %> message:`, message.data);

    // Example: Process the message data
    // await this.service.processData(message.data);

    // Example: Emit to another topic
    // await this.pubSubService.publish('another-topic', {
    //   source: '<%= topicName %>',
    //   data: message.data
    // });
  }

  /**
   * Handle errors from <%= topicName %> topic
   * Optional: Add error handling for the same topic
   *
   * @param message - The PubSub message that caused an error
   */
  // @Subscribe('<%= topicName %>.errors')
  // async handleErrors(message: IPubSubMessage<any>): Promise<void> {
  //   console.error(`Error processing <%= topicName %> message:`, message.data);
  //   // TODO: Implement error handling logic
  //   // await this.errorService.logError(message);
  // }

  /**
   * Handle additional related topics
   * You can add multiple handlers in the same listener
   */
  // @Subscribe('<%= topicName %>.created')
  // async handleCreated(message: IPubSubMessage<any>): Promise<void> {
  //   console.log(`<%= className %> created:`, message.data);
  //   // TODO: Implement created event logic
  // }

  // @Subscribe('<%= topicName %>.updated')
  // async handleUpdated(message: IPubSubMessage<any>): Promise<void> {
  //   console.log(`<%= className %> updated:`, message.data);
  //   // TODO: Implement updated event logic
  // }
}
